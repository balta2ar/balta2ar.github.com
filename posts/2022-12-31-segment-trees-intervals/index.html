<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Segment Trees for overlapping intervals | Mostly Technical</title><link rel=stylesheet href=/css/style.css><link rel=stylesheet href=/css/fonts.css><link rel=stylesheet href=//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css></head><body><nav><ul class=menu><li><a href=/>Home</a></li><li><a href=/about/>About</a></li><li><a href=/categories/>Categories</a></li><li><a href=/tags/>Tags</a></li><li><a href=/index.xml>Subscribe</a></li></ul><hr></nav><div class=article-meta><h1><span class=title>Segment Trees for overlapping intervals</span></h1><h2 class=date>2022/12/31</h2><p class=terms>Tags: <a href=/tags/algorithms>algorithms</a> <a href=/tags/data-structures>data structures</a> <a href=/tags/segment-trees>segment trees</a> <a href=/tags/p5js>p5js</a></p></div><main><p>Segment trees are a data structure that can be used for a variety of problems.
Usually, I&rsquo;ve seen them used for range queries, but they can also be used for
finding overlapping intervals.</p><p>When applied to the problem of answering range queries (e.g. sum on an interval),
the key idea with segment trees is to split the problem space into smaller parts
during preprocessing, so that during query we can visit only a small part of the
problem space. Exactly the same idea is used for finding overlapping intervals.</p><p>One important remark is that we&rsquo;re considering fixed intervals, i.g. we know all
intervals in advance before we do any preprocessing, and we can&rsquo;t insert/remove
intervals after preprocessing.</p><p>Let&rsquo;s consider 10 random intervals. We can generate them using the following code:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>randomIntervals</span>(<span style=color:#a6e22e>n</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>intervals</span> <span style=color:#f92672>=</span> [];
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>i</span> <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>n</span>; <span style=color:#a6e22e>i</span><span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>start</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>random</span>(<span style=color:#ae81ff>0</span>, <span style=color:#a6e22e>containerWidth</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>end</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>start</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>random</span>(<span style=color:#ae81ff>0</span>, (<span style=color:#a6e22e>containerWidth</span> <span style=color:#f92672>-</span> <span style=color:#a6e22e>start</span>) <span style=color:#f92672>/</span> <span style=color:#ae81ff>2</span>)
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>intervals</span>.<span style=color:#a6e22e>push</span>([<span style=color:#a6e22e>start</span>, <span style=color:#a6e22e>end</span>, <span style=color:#a6e22e>i</span>])
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>intervals</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>and they look like this:</p><iframe srcdoc='
<script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.5.0/p5.min.js"></script>
<script src="/js/p5js-global.js"></script>

<script src="page.js"></script>

<div class="p5js" id="p5js-container" style="width: 100%; height: 100px;"></div>
<script src="v1-intervals.js"></script>
' id=iframe-v1-intervals style=width:100%;height:100px;overflow:hidden scrolling=no frameborder=0><p>Your browser does not support iframes.</p></iframe><p>Instead of working directly with $n$ float coordinates, we&rsquo;ll convert intervals to
an array of $N = 2n$ endpoints, which we will also sort by their value. On the picture
above the endpoints are marked with magenta vertical lines.</p><p>It&rsquo;s important to both sort the endpoints by value and keep the reference to the
original interval index. We don&rsquo;t need to know whether that inteval is a start or
an end, but we&rsquo;ll need indices later.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>Endpoint</span>(<span style=color:#a6e22e>v</span>, <span style=color:#a6e22e>ix</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>v</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>v</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>ix</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>ix</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>buildEndpoints</span>(<span style=color:#a6e22e>intervals</span>) {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>eps</span> <span style=color:#f92672>=</span> []
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>const</span> [<span style=color:#a6e22e>ix</span>, [<span style=color:#a6e22e>start</span>, <span style=color:#a6e22e>end</span>]] <span style=color:#66d9ef>of</span> <span style=color:#a6e22e>intervals</span>.<span style=color:#a6e22e>entries</span>()) {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>eps</span>.<span style=color:#a6e22e>push</span>(<span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Endpoint</span>(<span style=color:#a6e22e>start</span>, <span style=color:#a6e22e>ix</span>))
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>eps</span>.<span style=color:#a6e22e>push</span>(<span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Endpoint</span>(<span style=color:#a6e22e>end</span>, <span style=color:#a6e22e>ix</span>))
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>eps</span>.<span style=color:#a6e22e>sort</span>((<span style=color:#a6e22e>a</span>, <span style=color:#a6e22e>b</span>) =&gt; <span style=color:#a6e22e>a</span>.<span style=color:#a6e22e>v</span> <span style=color:#f92672>-</span> <span style=color:#a6e22e>b</span>.<span style=color:#a6e22e>v</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>eps</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>The next step is to build the auxilary nodes in the tree.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>Node</span>(<span style=color:#a6e22e>b</span>, <span style=color:#a6e22e>e</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>b</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>b</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>e</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>e</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>left</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>null</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>right</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>null</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>key</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>aux</span> <span style=color:#f92672>=</span> []
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>build</span>(<span style=color:#a6e22e>eps</span>, <span style=color:#a6e22e>level</span>, <span style=color:#a6e22e>s</span>, <span style=color:#a6e22e>t</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>v</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Node</span>(<span style=color:#a6e22e>s</span>, <span style=color:#a6e22e>t</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>mark</span>(<span style=color:#a6e22e>eps</span>, <span style=color:#a6e22e>level</span>, <span style=color:#a6e22e>s</span>, <span style=color:#a6e22e>t</span>, <span style=color:#a6e22e>cBuilt</span>, <span style=color:#ae81ff>20</span>, <span style=color:#ae81ff>2</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>s</span><span style=color:#f92672>+</span><span style=color:#ae81ff>1</span> <span style=color:#f92672>==</span> <span style=color:#a6e22e>t</span>) { <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>v</span> }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>m</span> <span style=color:#f92672>=</span> Math.<span style=color:#a6e22e>floor</span>((<span style=color:#a6e22e>s</span><span style=color:#f92672>+</span><span style=color:#a6e22e>t</span>)<span style=color:#f92672>/</span><span style=color:#ae81ff>2</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>v</span>.<span style=color:#a6e22e>key</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>m</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>v</span>.<span style=color:#a6e22e>left</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>build</span>(<span style=color:#a6e22e>eps</span>, <span style=color:#a6e22e>level</span><span style=color:#f92672>+</span><span style=color:#ae81ff>1</span>, <span style=color:#a6e22e>s</span>, <span style=color:#a6e22e>m</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>v</span>.<span style=color:#a6e22e>right</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>build</span>(<span style=color:#a6e22e>eps</span>, <span style=color:#a6e22e>level</span><span style=color:#f92672>+</span><span style=color:#ae81ff>1</span>, <span style=color:#a6e22e>m</span>, <span style=color:#a6e22e>t</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>v</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><iframe srcdoc='
<script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.5.0/p5.min.js"></script>
<script src="/js/p5js-global.js"></script>

<script src="page.js"></script>

<div class="p5js" id="p5js-container" style="width: 100%; height: 100px;"></div>
<script src="v2-build.js"></script>
' id=iframe-v2-build style=width:100%;height:100px;overflow:hidden scrolling=no frameborder=0><p>Your browser does not support iframes.</p></iframe><p>More content</p></main><footer><script src=//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script>
<script>hljs.configure({languages:[]}),hljs.highlightAll()</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-GKQQJJH05F"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-GKQQJJH05F",{anonymize_ip:!1})}</script><hr>© <a href=https://balta2ar.github.io>Yuri Bochkarev</a> 2009 &ndash; 2023 | <a href=https://github.com/balta2ar>Github</a>
<link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css><script defer src=https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.js></script>
<script defer src=https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/contrib/auto-render.min.js onload=renderMathInElement(document.body)></script>
<script>document.addEventListener("DOMContentLoaded",function(){renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1}]})})</script>| <a href=https://github.com/balta2ar/balta2ar.github.com/edit/main/content/posts/2022-12-31-segment-trees-intervals/index.md>Edit this page</a></footer></body></html>