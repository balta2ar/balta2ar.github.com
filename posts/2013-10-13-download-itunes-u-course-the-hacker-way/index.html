<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"  lang="en-us">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1"/>

<title>Downloading iTunes U Course - The Hacker Way | Mostly Technical</title>


<link rel="stylesheet" href="/css/style.css"/></head>
<body>

<section class="section">
  <div class="container">
    <nav class="nav">
      <div class="nav-left">
        <a class="nav-item" href="https://balta2ar.github.io/"><h1 class="title is-4">Mostly Technical</h1></a>
      </div>
      <div class="nav-right">
        <nav class="nav-item level is-mobile"></nav>
      </div>
    </nav>

    
  </div>
</section>

<section class="section">
  <div class="container">
    <div class="subtitle is-6 is-pulled-right">
      
    </div>
    <h2 class="subtitle is-6">October 13, 2013</h2>
    <h1 class="title">Downloading iTunes U Course - The Hacker Way</h1>
    
    <div class="content">
      

<p>Today, kids, we are going to download iTunes U course almost exclusively from
the command line.</p>

<!-- more -->

<h2 id="why">Why</h2>

<p>The easiest way to do that is to use iTunes to download all that for you.
Unfortunately, while I have iPod/iPad in my home ecosystem, I don&rsquo;t have any
Mac computers. Thus, I&rsquo;m running iTunes in a virtual machine on Windows.
Imagine my user experience from such combination. Pure pain and suffering.</p>

<p>There wouldn&rsquo;t be this post if it was all smooth. For unknown reasons my iTunes
doesn&rsquo;t save downloaded video files. I can see it&rsquo;s downloading them, I can
see the temp file growing, but when it&rsquo;s done, puff, I can&rsquo;t find the file
anywhere. Luckily, there is a solution. It is a pity but you still need iTunes
for a couple of steps.</p>

<h2 id="how">How</h2>

<p>OK, let&rsquo;s do it. Say, you found an interesting course on iTunes U:</p>


<figure>
    
        <img src="/images/2013-10-13/ml.png" />
    
    
</figure>


<h3 id="step-1-subscribe-to-the-course-in-itunes">Step 1. Subscribe to the course in iTunes</h3>

<h3 id="step-2-copy-course-url">Step 2. Copy course url</h3>

<p>Click on any item in the course materials list and
select &ldquo;Copy iTunes U URL&rdquo;.</p>


<figure>
    
        <img src="/images/2013-10-13/copy-url.png" />
    
    
</figure>


<p>NB: There is <a href="https://itunesu.itunes.apple.com/coursemanager/">iTunes U Course Manager</a>
web page and I presume you might get the feed URL there (though I really doubt
you can). However, my country isn&rsquo;t enjoying Apple&rsquo;s favour.</p>


<figure>
    
        <img src="/images/2013-10-13/bad-country.png" />
    
    
</figure>


<h3 id="step-3-download-the-feed">Step 3. Download the feed</h3>

<pre><code>wget -O list.xml https://p1-u.itunes.apple.com/WebObjects/LZStudent.woa/ra/feed/CODBABB3ZC
</code></pre>

<h3 id="step-4-extract-links-and-titles">Step 4. Extract links and titles</h3>

<p>The feed contains <code>feed/entry</code> items in the format as follows:</p>
<div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#007020">&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span>
<span style="color:#062873;font-weight:bold">&lt;feed</span> <span style="color:#4070a0">xmlns=</span><span style="color:#4070a0">&#34;http://www.w3.org/2005/Atom&#34;</span> <span style="color:#4070a0">xmlns:itms=</span><span style="color:#4070a0">&#34;http://www.itunes.com/dtds/itunesu-1.0.dtd&#34;</span><span style="color:#062873;font-weight:bold">&gt;</span>
    <span style="color:#062873;font-weight:bold">&lt;title</span> <span style="color:#4070a0">type=</span><span style="color:#4070a0">&#34;text&#34;</span><span style="color:#062873;font-weight:bold">&gt;</span>Machine Learning<span style="color:#062873;font-weight:bold">&lt;/title&gt;</span>
    <span style="color:#062873;font-weight:bold">&lt;subtitle</span> <span style="color:#4070a0">type=</span><span style="color:#4070a0">&#34;text&#34;</span><span style="color:#062873;font-weight:bold">&gt;</span><span style="color:#d55537;font-weight:bold">&amp;lt;</span>div<span style="color:#d55537;font-weight:bold">&amp;gt;&amp;lt;</span>div<span style="color:#d55537;font-weight:bold">&amp;gt;&amp;lt;</span>strong<span style="color:#d55537;font-weight:bold">&amp;gt;</span>A real Caltech course...<span style="color:#062873;font-weight:bold">&lt;/subtitle&gt;</span>
    <span style="color:#062873;font-weight:bold">&lt;updated&gt;</span>2013-06-12T00:19:12PDT<span style="color:#062873;font-weight:bold">&lt;/updated&gt;</span>
    <span style="color:#062873;font-weight:bold">&lt;link</span> <span style="color:#4070a0">rel=</span><span style="color:#4070a0">&#34;alternate&#34;</span> <span style="color:#4070a0">type=</span><span style="color:#4070a0">&#34;text/html&#34;</span>
          <span style="color:#4070a0">href=</span><span style="color:#4070a0">&#34;https://p1-u.itunes.apple.com/WebObjects/LZStudent.woa/ra/courses/CODBABB3ZC&#34;</span><span style="color:#062873;font-weight:bold">/&gt;</span>
    <span style="color:#062873;font-weight:bold">&lt;id&gt;</span>1/CODBABB3ZC<span style="color:#062873;font-weight:bold">&lt;/id&gt;</span>
    <span style="color:#062873;font-weight:bold">&lt;itms:courseid&gt;</span>CODBABB3ZC<span style="color:#062873;font-weight:bold">&lt;/itms:courseid&gt;</span>
    <span style="color:#062873;font-weight:bold">&lt;itms:auditUrl&gt;</span>https://itunesu.itunes.apple.com/audit/CODBABB3ZC<span style="color:#062873;font-weight:bold">&lt;/itms:auditUrl&gt;</span>


    <span style="color:#062873;font-weight:bold">&lt;entry&gt;</span>
        <span style="color:#062873;font-weight:bold">&lt;author&gt;</span>
            <span style="color:#062873;font-weight:bold">&lt;name&gt;</span>Dr. Yaser Abu-Mostafa<span style="color:#062873;font-weight:bold">&lt;/name&gt;</span>
        <span style="color:#062873;font-weight:bold">&lt;/author&gt;</span>
        <span style="color:#062873;font-weight:bold">&lt;title</span> <span style="color:#4070a0">type=</span><span style="color:#4070a0">&#34;html&#34;</span><span style="color:#062873;font-weight:bold">&gt;</span><span style="color:#007020">&lt;![CDATA[AC___Lecture 01 slides]]&gt;</span><span style="color:#062873;font-weight:bold">&lt;/title&gt;</span>
        <span style="color:#062873;font-weight:bold">&lt;id&gt;</span>1/CODBABB3ZC/MAES7ECEVA<span style="color:#062873;font-weight:bold">&lt;/id&gt;</span>
        <span style="color:#062873;font-weight:bold">&lt;updated&gt;</span>2013-06-11T23:25:24PDT<span style="color:#062873;font-weight:bold">&lt;/updated&gt;</span>
        <span style="color:#062873;font-weight:bold">&lt;published&gt;</span>2012-06-14T15:07:36PDT<span style="color:#062873;font-weight:bold">&lt;/published&gt;</span>
        <span style="color:#062873;font-weight:bold">&lt;summary</span> <span style="color:#4070a0">type=</span><span style="color:#4070a0">&#34;html&#34;</span><span style="color:#062873;font-weight:bold">&gt;</span><span style="color:#007020">&lt;![CDATA[AC___Lecture 01 slides]]&gt;</span><span style="color:#062873;font-weight:bold">&lt;/summary&gt;</span>
        <span style="color:#062873;font-weight:bold">&lt;link</span> <span style="color:#4070a0">rel=</span><span style="color:#4070a0">&#34;enclosure&#34;</span> <span style="color:#4070a0">type=</span><span style="color:#4070a0">&#34;application/pdf&#34;</span>
              <span style="color:#4070a0">href=</span><span style="color:#4070a0">&#34;http://a1372.phobos.apple.com/us/r30/CobaltPublic/v4/35/56/6a/35566a02-1e0a-3db8-17e2-69be6445ba9b/208-5815754981465838988-ACsld01.pdf&#34;</span>
    <span style="color:#4070a0">length=</span><span style="color:#4070a0">&#34;300673&#34;</span><span style="color:#062873;font-weight:bold">/&gt;</span>
    <span style="color:#062873;font-weight:bold">&lt;/entry&gt;</span>

...</code></pre></div>
<p>It is very convenient to use <a href="http://xmlstar.sourceforge.net/doc/UG/xmlstarlet-ug.html">xmlstartlet</a>
to extract titles and links from the feed. Note, however, that xmlstartlet is
very picky to namespace (thanks to <a href="http://stackoverflow.com/questions/9025492/xmlstarlet-does-not-select-anything">this</a>
answer). Extraction command will look as follows:</p>

<pre><code>xml sel -N x=&quot;http://www.w3.org/2005/Atom&quot; -t -m //x:entry -v x:title -o &quot;|&quot; -v x:link/@href -n list.xml &gt; fmt.txt
</code></pre>

<h3 id="step-5-download-the-course">Step 5. Download the course</h3>

<p>Now all that is left is to read titles and links and
download them. I prefer to use <a href="http://aria2.sourceforge.net/">aria2c</a></p>

<pre><code>IFS='|' &amp;&amp; while read a b; do n=$a.${b##*.}; aria2c --allow-overwrite=false --auto-file-renaming=false -o $n $b; done &lt; fmt.txt
</code></pre>

<p><code>${b##*.}</code> is a command to get filename extension (see <a href="http://stackoverflow.com/questions/965053/extract-filename-and-extension-in-bash">this</a>
and <a href="http://www.gnu.org/software/bash/manual/html_node/Shell-Parameter-Expansion.html#Shell-Parameter-Expansion">this</a>)</p>

<h2 id="references">References</h2>

<ol>
<li><a href="http://alistairisrael.wordpress.com/2007/09/26/querying-an-xml-document-using-xmlstarlet/">Querying an XML document using XMLStarlet</a></li>
<li><a href="http://xmlstar.sourceforge.net/doc/UG/xmlstarlet-ug.html">XmlStarlet Command Line XML Toolkit User&rsquo;s Guide</a></li>
<li><a href="http://www.freesoftwaremagazine.com/articles/xml_starlet">XMLStarlet: a Unix toolkit for XML</a></li>
</ol>

      
    </div>
    
  </div>
</section>


<section class="section">
  <div class="container has-text-centered">
    <p></p>
    
  </div>
</section>

</body>
</html>

