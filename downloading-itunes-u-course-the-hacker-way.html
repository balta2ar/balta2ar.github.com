<!DOCTYPE html>
<html lang="en">
<head>
        <meta charset="utf-8" />
        <title>“Downloading iTunes U Course - The Hacker Way”</title>
        <link rel="stylesheet" href="http://balta2ar.github.io/theme/css/main.css" />
        <link href="http://balta2ar.github.io/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Mostly Technical Atom Feed" />

        <!--[if IE]>
            <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="http://balta2ar.github.io/">Mostly Technical </a></h1>
                <nav><ul>
                    <li class="active"><a href="http://balta2ar.github.io/category/misc.html">misc</a></li>
                </ul>
                </nav>
        </header><!-- /#banner -->
<section id="content" class="body">
  <article>
    <header>
      <h1 class="entry-title">
        <a href="http://balta2ar.github.io/downloading-itunes-u-course-the-hacker-way.html" rel="bookmark"
           title="Permalink to “Downloading iTunes U Course - The Hacker Way”"><span class="dquo">&#8220;</span>Downloading iTunes U Course - The Hacker&nbsp;Way&#8221;</a></h1>
    </header>

    <div class="entry-content">
<footer class="post-info">
        <span>Sun 13 October 2013</span>

</footer><!-- /.post-info -->      <p>Today, kids, we are going to download iTunes U course almost exclusively from
the command&nbsp;line.</p>
<!-- more -->

<h2>Why</h2>
<p>The easiest way to do that is to use iTunes to download all that for you.
Unfortunately, while I have iPod/iPad in my home ecosystem, I don&#8217;t have any
Mac computers. Thus, I&#8217;m running iTunes in a virtual machine on Windows.
Imagine my user experience from such combination. Pure pain and&nbsp;suffering.</p>
<p>There wouldn&#8217;t be this post if it was all smooth. For unknown reasons my iTunes
doesn&#8217;t save downloaded video files. I can see it&#8217;s downloading them, I can
see the temp file growing, but when it&#8217;s done, puff, I can&#8217;t find the file
anywhere. Luckily, there is a solution. It is a pity but you still need iTunes
for a couple of&nbsp;steps.</p>
<h2>How</h2>
<p><span class="caps">OK</span>, let&#8217;s do it. Say, you found an interesting course on iTunes&nbsp;U:</p>
<p><img alt="" src="http://balta2ar.github.io/images/ml.png"></p>
<h3>Step 1. Subscribe to the course in&nbsp;iTunes</h3>
<h3>Step 2. Copy course&nbsp;url</h3>
<p>Click on any item in the course materials list and
select &#8220;Copy iTunes U <span class="caps">URL</span>&#8221;.</p>
<p><img alt="" src="http://balta2ar.github.io/images/copy-url.png"></p>
<p><span class="caps">NB</span>: There is <a href="https://itunesu.itunes.apple.com/coursemanager/">iTunes U Course Manager</a>
web page and I presume you might get the feed <span class="caps">URL</span> there (though I really doubt
you can). However, my country isn&#8217;t enjoying Apple&#8217;s&nbsp;favour.</p>
<p><img alt="" src="http://balta2ar.github.io/images/bad-country.png"></p>
<h3>Step 3. Download the&nbsp;feed</h3>
<div class="highlight"><pre><span></span>wget -O list.xml https://p1-u.itunes.apple.com/WebObjects/LZStudent.woa/ra/feed/CODBABB3ZC
</pre></div>


<h3>Step 4. Extract links and&nbsp;titles</h3>
<p>The feed contains <code>feed/entry</code> items in the format as&nbsp;follows:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="nt">&lt;feed</span> <span class="na">xmlns=</span><span class="s">&quot;http://www.w3.org/2005/Atom&quot;</span> <span class="na">xmlns:itms=</span><span class="s">&quot;http://www.itunes.com/dtds/itunesu-1.0.dtd&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;title</span> <span class="na">type=</span><span class="s">&quot;text&quot;</span><span class="nt">&gt;</span>Machine Learning<span class="nt">&lt;/title&gt;</span>
    <span class="nt">&lt;subtitle</span> <span class="na">type=</span><span class="s">&quot;text&quot;</span><span class="nt">&gt;</span><span class="ni">&amp;lt;</span>div<span class="ni">&amp;gt;&amp;lt;</span>div<span class="ni">&amp;gt;&amp;lt;</span>strong<span class="ni">&amp;gt;</span>A real Caltech course...<span class="nt">&lt;/subtitle&gt;</span>
    <span class="nt">&lt;updated&gt;</span>2013-06-12T00:19:12PDT<span class="nt">&lt;/updated&gt;</span>
    <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">&quot;alternate&quot;</span> <span class="na">type=</span><span class="s">&quot;text/html&quot;</span>
          <span class="na">href=</span><span class="s">&quot;https://p1-u.itunes.apple.com/WebObjects/LZStudent.woa/ra/courses/CODBABB3ZC&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;id&gt;</span>1/CODBABB3ZC<span class="nt">&lt;/id&gt;</span>
    <span class="nt">&lt;itms:courseid&gt;</span>CODBABB3ZC<span class="nt">&lt;/itms:courseid&gt;</span>
    <span class="nt">&lt;itms:auditUrl&gt;</span>https://itunesu.itunes.apple.com/audit/CODBABB3ZC<span class="nt">&lt;/itms:auditUrl&gt;</span>


    <span class="nt">&lt;entry&gt;</span>
        <span class="nt">&lt;author&gt;</span>
            <span class="nt">&lt;name&gt;</span>Dr. Yaser Abu-Mostafa<span class="nt">&lt;/name&gt;</span>
        <span class="nt">&lt;/author&gt;</span>
        <span class="nt">&lt;title</span> <span class="na">type=</span><span class="s">&quot;html&quot;</span><span class="nt">&gt;</span><span class="cp">&lt;![CDATA[AC___Lecture 01 slides]]&gt;</span><span class="nt">&lt;/title&gt;</span>
        <span class="nt">&lt;id&gt;</span>1/CODBABB3ZC/MAES7ECEVA<span class="nt">&lt;/id&gt;</span>
        <span class="nt">&lt;updated&gt;</span>2013-06-11T23:25:24PDT<span class="nt">&lt;/updated&gt;</span>
        <span class="nt">&lt;published&gt;</span>2012-06-14T15:07:36PDT<span class="nt">&lt;/published&gt;</span>
        <span class="nt">&lt;summary</span> <span class="na">type=</span><span class="s">&quot;html&quot;</span><span class="nt">&gt;</span><span class="cp">&lt;![CDATA[AC___Lecture 01 slides]]&gt;</span><span class="nt">&lt;/summary&gt;</span>
        <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">&quot;enclosure&quot;</span> <span class="na">type=</span><span class="s">&quot;application/pdf&quot;</span>
              <span class="na">href=</span><span class="s">&quot;http://a1372.phobos.apple.com/us/r30/CobaltPublic/v4/35/56/6a/35566a02-1e0a-3db8-17e2-69be6445ba9b/208-5815754981465838988-ACsld01.pdf&quot;</span>
    <span class="na">length=</span><span class="s">&quot;300673&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/entry&gt;</span>

...
</pre></div>


<p>It is very convenient to use <a href="http://xmlstar.sourceforge.net/doc/UG/xmlstarlet-ug.html">xmlstartlet</a>
to extract titles and links from the feed. Note, however, that xmlstartlet is
very picky to namespace (thanks to <a href="http://stackoverflow.com/questions/9025492/xmlstarlet-does-not-select-anything">this</a>
answer). Extraction command will look as&nbsp;follows:</p>
<div class="highlight"><pre><span></span>xml sel -N x=&quot;http://www.w3.org/2005/Atom&quot; -t -m //x:entry -v x:title -o &quot;|&quot; -v x:link/@href -n list.xml &gt; fmt.txt
</pre></div>


<h3>Step 5. Download the&nbsp;course</h3>
<p>Now all that is left is to read titles and links and
download them. I prefer to use <a href="http://aria2.sourceforge.net/">aria2c</a></p>
<div class="highlight"><pre><span></span>IFS=&#39;|&#39; <span class="err">&amp;&amp;</span> while read a b; do n=<span class="nv">$a.</span><span class="cp">${</span><span class="n">b</span><span class="c1">##*.</span><span class="cp">}</span>; aria2c --allow-overwrite=false --auto-file-renaming=false -o <span class="nv">$n</span> <span class="nv">$b</span>; done <span class="nt">&lt; fmt.txt</span>
</pre></div>


<p><code>${b##*.}</code> is a command to get filename extension (see <a href="http://stackoverflow.com/questions/965053/extract-filename-and-extension-in-bash">this</a>
and <a href="http://www.gnu.org/software/bash/manual/html_node/Shell-Parameter-Expansion.html#Shell-Parameter-Expansion">this</a>)</p>
<h2>References</h2>
<ol>
<li><a href="http://alistairisrael.wordpress.com/2007/09/26/querying-an-xml-document-using-xmlstarlet/">Querying an <span class="caps">XML</span> document using&nbsp;XMLStarlet</a></li>
<li><a href="http://xmlstar.sourceforge.net/doc/UG/xmlstarlet-ug.html">XmlStarlet Command Line <span class="caps">XML</span> Toolkit User&#8217;s&nbsp;Guide</a></li>
<li><a href="http://www.freesoftwaremagazine.com/articles/xml_starlet">XMLStarlet: a Unix toolkit for <span class="caps">XML</span></a></li>
</ol>
    </div><!-- /.entry-content -->

  </article>
</section>
        <section id="extras" class="body">
                <div class="social">
                        <h2>social</h2>
                        <ul>
                            <li><a href="http://balta2ar.github.io/feeds/all.atom.xml" type="application/atom+xml" rel="alternate">atom feed</a></li>

                        </ul>
                </div><!-- /.social -->
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <p>Powered by <a href="http://getpelican.com/">Pelican</a>. Theme <a href="https://github.com/blueicefield/pelican-blueidea/">blueidea</a>, inspired by the default theme.</p>
        </footer><!-- /#contentinfo -->

</body>
</html>